<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue AI Use Cases Heatmap</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 40px rgba(0,0,0,0.08);
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        h1 {
            margin: 0;
            font-size: 2em;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            margin-top: 8px;
            font-size: 0.95em;
            opacity: 0.9;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #fafbfc;
            border-bottom: 1px solid #e1e4e8;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin: 0;
            line-height: 1;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.85em;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .controls {
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #e1e4e8;
        }
        
        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: 500;
            color: #374151;
            font-size: 0.85em;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.85em;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-select:hover {
            border-color: #667eea;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        #reset-filters {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        #reset-filters:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .visualization-container {
            padding: 20px 20px;
            overflow-x: auto;
        }
        
        #heatmap-container {
            display: flex;
            justify-content: center;
            min-width: fit-content;
        }
        
        .cell {
            cursor: pointer;
            stroke: white;
            stroke-width: 2px;
            transition: all 0.2s ease;
            rx: 4;
            ry: 4;
        }
        
        .cell:hover {
            stroke: #4b5563;
            stroke-width: 2px;
            filter: brightness(0.85);
            transform: scale(1.02);
        }
        
        .axis-label {
            font-size: 12px;
            font-weight: 600;
            fill: #374151;
        }
        
        .y-axis-label {
            text-anchor: end;
            font-size: 12px;
        }
        
        .x-axis-label {
            text-anchor: middle;
        }
        
        .cell-value {
            font-size: 16px;
            font-weight: 700;
            pointer-events: none;
        }
        
        .tooltip {
            position: absolute;
            padding: 12px 16px;
            background: rgba(17, 24, 39, 0.95);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            font-size: 14px;
            line-height: 1.5;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .legend {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px 15px 20px;
            gap: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: #6b7280;
            font-weight: 500;
        }
        
        .legend-gradient {
            width: 180px;
            height: 20px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 24px 30px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fafbfc;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #1f2937;
            font-size: 1.5em;
        }
        
        .close {
            color: #6b7280;
            font-size: 28px;
            font-weight: 300;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s;
        }
        
        .close:hover {
            color: #1f2937;
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex: 1;
        }
        
        .solution-item {
            border-bottom: 1px solid #f3f4f6;
            padding: 20px 0;
            transition: background 0.2s;
        }
        
        .solution-item:hover {
            background: #fafbfc;
            margin: 0 -30px;
            padding: 20px 30px;
        }
        
        .solution-item:last-child {
            border-bottom: none;
        }
        
        .solution-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .solution-meta {
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 12px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .solution-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .solution-description {
            font-size: 14px;
            line-height: 1.6;
            color: #4b5563;
        }
        
        .solution-links {
            margin-top: 12px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .solution-links a {
            color: #667eea;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border: 1px solid #667eea;
            border-radius: 6px;
            transition: all 0.2s;
            display: inline-block;
        }
        
        .solution-links a:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            .container {
                width: 100%;
                max-width: 100%;
                box-shadow: none;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .subtitle {
                font-size: 0.85em;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 15px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-number {
                font-size: 1.8em;
            }
            
            .filters {
                flex-direction: column;
                gap: 10px;
            }
            
            .legend {
                padding: 0 15px 10px 15px;
            }
            
            .legend-item {
                font-size: 11px;
                gap: 8px;
            }
            
            .legend-gradient {
                width: 140px;
                height: 16px;
            }
            
            .visualization-container {
                padding: 15px 5px;
                overflow-x: hidden;
            }
            
            #heatmap-container {
                overflow-x: hidden;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
            }
            
            .axis-label {
                font-size: 10px;
            }
            
            .cell-value {
                font-size: 10px;
            }
            
            .tooltip {
                font-size: 12px;
            }
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error {
            text-align: center;
            padding: 60px 20px;
            color: #ef4444;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 0 20px;
        }
        
        .view-btn {
            padding: 8px 16px;
            border: 1px solid #e5e7eb;
            background-color: #ffffff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .view-btn:hover:not(.active) {
            background-color: #f3f4f6;
        }
        
        .word-cloud-container {
            padding: 20px;
            height: 500px;
            overflow: auto;
            text-align: center;
        }
        
        .word-cloud-word {
            display: inline-block;
            padding: 4px 8px;
            margin: 4px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            text-decoration: none;
            color: #1f2937;
        }
        
        .word-cloud-word:hover {
            background-color: #e5e7eb;
            transform: scale(1.1);
        }
        
        .word-cloud-word.selected {
            background-color: #3b82f6;
            color: white;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .grid-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .grid-item h3 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1.5rem;
        }

        .grid-item span {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .grid-item:hover {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .list-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(30, 41, 59, 0.98);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .list-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .list-view h2 {
            color: white;
            margin: 0;
            font-size: 2rem;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .solution-list {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .solution-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .solution-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .solution-item h3 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
        }
        
        .solution-item .description {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }
        
        .solution-item .meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .solution-item .meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .solution-links {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        
        .solution-links a {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .solution-links a:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .interstitial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .interstitial-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .interstitial-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .interstitial-item h3 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1.5rem;
        }
        
        .interstitial-item .count {
            color: rgba(255, 255, 255, 0.6);
            font-size: 2rem;
            font-weight: bold;
        }
        
        .list-view-cloud {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .list-view-cloud .tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .list-view-cloud .tag:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .list-view-cloud .tag.active {
            background: rgba(59, 130, 246, 0.5);
            border-color: rgb(59, 130, 246);
        }
        
        .filter-info {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        
        .experimental-toggle {
            background: rgba(147, 51, 234, 0.2);
            border: 1px solid rgb(147, 51, 234);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto;
            display: block;
        }
        
        .experimental-toggle:hover {
            background: rgba(147, 51, 234, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.3);
        }
        
        .experimental-toggle.active {
            background: rgba(147, 51, 234, 0.6);
            box-shadow: 0 0 20px rgba(147, 51, 234, 0.5);
        }
        
        .jobs-legend {
            display: none;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .jobs-legend h3 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }
        
        .job-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            font-size: 0.85rem;
        }
        
        .job-item {
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Revenue AI Use Cases Heatmap</h1>
            <div class="subtitle">Interactive visualization of AI solutions built across roles and solution types</div>
            <div style="margin-top: 1rem;">
                <button id="experimentalToggle" class="experimental-toggle" onclick="toggleExperimentalView()">
                    🧪 Experimental: Jobs View
                </button>
            </div>
        </div>
        
        <div class="stats" id="stats-container">
            <!-- Stats will be populated by JavaScript -->
        </div>
        
        <div class="controls">
            <div class="filters">
                <div class="filter-group">
                    <label for="region-filter">Region:</label>
                    <select id="region-filter" class="filter-select">
                        <option value="all">All Regions</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="date-filter">Time Period:</label>
                    <select id="date-filter" class="filter-select">
                        <option value="all">All Time</option>
                        <option value="30">Last 30 days</option>
                        <option value="60">Last 60 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                </div>
                <button id="reset-filters">Reset Filters</button>
            </div>
        </div>
        
        <div class="legend" id="defaultLegend">
            <div class="legend-item">
                <span>Low Activity</span>
                <svg width="180" height="20">
                    <defs>
                        <linearGradient id="legend-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#f0f9ff;stop-opacity:1" />
                            <stop offset="25%" style="stop-color:#bae6fd;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#60a5fa;stop-opacity:1" />
                            <stop offset="75%" style="stop-color:#3b82f6;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect width="180" height="20" fill="url(#legend-gradient)" rx="4" />
                </svg>
                <span>High Activity</span>
            </div>
        </div>
        
        <div class="jobs-legend" id="jobsLegend">
            <h3>Jobs to be Done Categories:</h3>
            <div class="job-items" id="jobCategories">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="visualization-container">
            <p id="mobile-hint" style="display: none; text-align: center; color: #6b7280; font-size: 12px; margin: 0 0 10px 0;">
                Tap once to preview, tap again to view details
            </p>
            <div id="heatmap-container">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading visualization...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip"></div>
    
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title"></h2>
                <span class="close">&times;</span>
            </div>
            <div class="view-toggle">
                <button id="list-view-btn" class="view-btn active">List View</button>
                <button id="cloud-view-btn" class="view-btn">Word Cloud</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div id="word-cloud" class="word-cloud-container" style="display: none;"></div>
        </div>
    </div>
    
    <div id="allSolutionsView" class="list-view">
        <div class="list-view-header">
            <h2>All Revenue AI Solutions</h2>
            <button class="close-btn" onclick="closeListView('allSolutionsView')">Close</button>
        </div>
        <div class="filter-info" id="allSolutionsFilterInfo"></div>
        <div class="list-view-cloud" id="allSolutionsCloud"></div>
        <div class="solution-list" id="allSolutionsList"></div>
    </div>
    
    <div id="rolesListView" class="list-view">
        <div class="list-view-header">
            <h2>Solutions by Role</h2>
            <button class="close-btn" onclick="closeListView('rolesListView')">Close</button>
        </div>
        <div class="interstitial-grid" id="rolesGrid"></div>
    </div>
    
    <div id="solutionTypesListView" class="list-view">
        <div class="list-view-header">
            <h2>Solutions by Type</h2>
            <button class="close-btn" onclick="closeListView('solutionTypesListView')">Close</button>
        </div>
        <div class="interstitial-grid" id="solutionTypesGrid"></div>
    </div>
    
    <div id="roleDetailView" class="list-view">
        <div class="list-view-header">
            <h2 id="roleDetailTitle"></h2>
            <button class="close-btn" onclick="closeListView('roleDetailView')">Back</button>
        </div>
        <div class="filter-info" id="roleDetailFilterInfo"></div>
        <div class="list-view-cloud" id="roleDetailCloud"></div>
        <div class="solution-list" id="roleDetailList"></div>
    </div>
    
    <div id="typeDetailView" class="list-view">
        <div class="list-view-header">
            <h2 id="typeDetailTitle"></h2>
            <button class="close-btn" onclick="closeListView('typeDetailView')">Back</button>
        </div>
        <div class="filter-info" id="typeDetailFilterInfo"></div>
        <div class="list-view-cloud" id="typeDetailCloud"></div>
        <div class="solution-list" id="typeDetailList"></div>
    </div>
    
    <script>
        // Load data and initialize visualization
        let globalData = null;
        let currentData = null;
        let csvData = [];
        let currentView = null;
        let currentListFilters = new Set();
        let lastTappedCell = null;
        let tapTimeout = null;
        let jobsData = null;
        let isExperimentalView = false;
        const tooltip = d3.select('.tooltip');
        
        // Use absolute URL to ensure it works on GitHub Pages
        const dataUrl = window.location.hostname === 'pomajp.github.io' 
            ? 'https://pomajp.github.io/revai-heatmap/revai-data.json'
            : 'revai-data.json';
            
        const jobsDataUrl = window.location.hostname === 'pomajp.github.io' 
            ? 'https://pomajp.github.io/revai-heatmap/revai-jobs-data.json'
            : 'revai-jobs-data.json';
        
        console.log('Hostname:', window.location.hostname);
        console.log('Loading data from:', dataUrl);
        
        fetch(dataUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                globalData = data;
                currentData = data;
                csvData = data.allEntries || [];
                initializeFilters(data);
                updateStats(data);
                createHeatmap(data);
                
                // Load jobs data for experimental view
                return fetch(jobsDataUrl);
            })
            .then(response => response.json())
            .then(data => {
                jobsData = data;
                console.log('Jobs data loaded:', data);
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.getElementById('heatmap-container').innerHTML = 
                    `<div class="error">Error loading data: ${error.message}<br>Please try refreshing the page.</div>`;
            });
        
        function initializeFilters(data) {
            // Populate region filter
            const regions = [...new Set(data.allEntries.map(e => e.region).filter(r => r))];
            const regionSelect = document.getElementById('region-filter');
            regions.sort().forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                regionSelect.appendChild(option);
            });
            
            // Add event listeners
            document.getElementById('region-filter').addEventListener('change', applyFilters);
            document.getElementById('date-filter').addEventListener('change', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
        }
        
        function applyFilters() {
            const regionFilter = document.getElementById('region-filter').value;
            const dateFilter = parseInt(document.getElementById('date-filter').value);
            
            let filteredEntries = globalData.allEntries;
            
            // Apply region filter
            if (regionFilter !== 'all') {
                filteredEntries = filteredEntries.filter(e => e.region === regionFilter);
            }
            
            // Apply date filter
            if (!isNaN(dateFilter)) {
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - dateFilter);
                filteredEntries = filteredEntries.filter(e => {
                    const entryDate = new Date(e.updatedAt);
                    return entryDate >= cutoffDate;
                });
            }
            
            // Rebuild heatmap data
            const newHeatmapData = {};
            const newRoleCounts = {};
            const newSolutionCounts = {};
            
            filteredEntries.forEach(entry => {
                entry.roles.forEach(role => {
                    if (!newHeatmapData[role]) newHeatmapData[role] = {};
                    if (!newHeatmapData[role][entry.solutionType]) {
                        newHeatmapData[role][entry.solutionType] = 0;
                    }
                    newHeatmapData[role][entry.solutionType]++;
                    newRoleCounts[role] = (newRoleCounts[role] || 0) + 1;
                });
                newSolutionCounts[entry.solutionType] = (newSolutionCounts[entry.solutionType] || 0) + 1;
            });
            
            // Get updated unique roles and solution types
            const activeRoles = Object.keys(newRoleCounts).sort();
            const activeSolutionTypes = Object.keys(newSolutionCounts).sort();
            
            currentData = {
                ...globalData,
                matrix: newHeatmapData,
                roleCounts: newRoleCounts,
                solutionCounts: newSolutionCounts,
                totalEntries: filteredEntries.length,
                allEntries: filteredEntries,
                roles: activeRoles.length > 0 ? activeRoles : globalData.roles,
                solutionTypes: activeSolutionTypes.length > 0 ? activeSolutionTypes : globalData.solutionTypes
            };
            
            updateStats(currentData);
            createHeatmap(currentData);
        }
        
        function resetFilters() {
            document.getElementById('region-filter').value = 'all';
            document.getElementById('date-filter').value = 'all';
            currentData = globalData;
            updateStats(globalData);
            createHeatmap(globalData);
        }
        
        function updateStats(data) {
            const statsContainer = document.getElementById('stats-container');
            const activeRoles = data.roles ? data.roles.length : 0;
            
            statsContainer.innerHTML = `
                <div class="stat-card" onclick="showAllSolutions()" style="cursor: pointer;">
                    <p class="stat-number">${data.totalEntries}</p>
                    <p class="stat-label">Total Solutions</p>
                </div>
                <div class="stat-card" onclick="showRolesList()" style="cursor: pointer;">
                    <p class="stat-number">${data.roles.length}</p>
                    <p class="stat-label">Unique Roles</p>
                </div>
                <div class="stat-card" onclick="showSolutionTypesList()" style="cursor: pointer;">
                    <p class="stat-number">${data.solutionTypes.length}</p>
                    <p class="stat-label">Solution Types</p>
                </div>
                <div class="stat-card">
                    <p class="stat-number">${activeRoles}</p>
                    <p class="stat-label">Active Roles</p>
                </div>
            `;
        }
        
        function createHeatmap(data) {
            // Clear existing heatmap
            d3.select("#heatmap-container").selectAll("*").remove();
            
            // Show mobile hint if on mobile
            if (window.innerWidth <= 768) {
                document.getElementById('mobile-hint').style.display = 'block';
            }
            
            // Create mapped solution types
            const mappedSolutionTypes = data.solutionTypes.map(type => 
                solutionTypeMap[type] || type
            );
            
            // Dynamically adjust cell size based on viewport
            const viewportWidth = window.innerWidth;
            const containerWidth = document.getElementById('heatmap-container').offsetWidth;
            
            // Calculate cell size to fit within viewport on mobile
            let cellSize;
            let margin;
            
            if (viewportWidth < 768) {
                // Mobile: calculate cell size to fit within viewport
                margin = { top: 80, right: 10, bottom: 30, left: 100 };
                const availableWidth = containerWidth - margin.left - margin.right;
                cellSize = Math.min(50, Math.floor(availableWidth / mappedSolutionTypes.length));
            } else {
                // Desktop
                cellSize = 70;
                margin = { top: 100, right: 20, bottom: 30, left: 180 };
            }
            
            const width = mappedSolutionTypes.length * cellSize + margin.left + margin.right;
            const height = data.roles.length * cellSize + margin.top + margin.bottom;
            
            // Create SVG
            const svg = d3.select("#heatmap-container")
                .append("svg")
                .attr("width", viewportWidth < 768 ? '100%' : width)
                .attr("height", height)
                .attr("viewBox", `0 0 ${width} ${height}`)
                .attr("preserveAspectRatio", "xMidYMid meet");
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // Create scales
            const xScale = d3.scaleBand()
                .domain(data.solutionTypes)
                .range([0, mappedSolutionTypes.length * cellSize])
                .padding(0.05);
            
            const yScale = d3.scaleBand()
                .domain(data.roles)
                .range([0, data.roles.length * cellSize])
                .padding(0.05);
            
            // Find max value for color scale
            let maxValue = 0;
            Object.values(data.matrix || {}).forEach(solutionTypes => {
                Object.values(solutionTypes).forEach(value => {
                    maxValue = Math.max(maxValue, value);
                });
            });
            
            // Color scale with better gradients
            const colorScale = d3.scaleSequential()
                .domain([0, maxValue])
                .interpolator(t => d3.interpolateBlues(t * 0.9 + 0.1)); // Avoid pure white
            
            // Create cells
            data.roles.forEach((role, i) => {
                data.solutionTypes.forEach((solutionType, j) => {
                    const value = (data.matrix && data.matrix[role] && data.matrix[role][solutionType]) || 0;
                    
                    const cell = g.append("rect")
                        .attr("x", xScale(solutionType))
                        .attr("y", yScale(role))
                        .attr("width", xScale.bandwidth())
                        .attr("height", yScale.bandwidth())
                        .attr("class", "cell")
                        .style("fill", value === 0 ? "#f9fafb" : colorScale(value))
                        .on("mouseover", function(event) {
                            showTooltip(event, role, solutionType, value);
                        })
                        .on("mouseout", function() {
                            if (window.innerWidth > 768) {
                                hideTooltip();
                            }
                        })
                        .on("click", function(event) {
                            if (window.innerWidth <= 768) {
                                // Mobile behavior: two-tap
                                const cellKey = `${role}-${solutionType}`;
                                
                                if (lastTappedCell === cellKey) {
                                    // Second tap - open details
                                    showDetails(role, solutionType, data);
                                    lastTappedCell = null;
                                    hideTooltip();
                                } else {
                                    // First tap - show tooltip
                                    lastTappedCell = cellKey;
                                    showTooltip(event, role, solutionType, value);
                                    
                                    // Clear previous timeout
                                    if (tapTimeout) clearTimeout(tapTimeout);
                                    
                                    // Hide tooltip after 3 seconds
                                    tapTimeout = setTimeout(() => {
                                        hideTooltip();
                                        lastTappedCell = null;
                                    }, 3000);
                                }
                            } else {
                                // Desktop behavior - immediate open
                                showDetails(role, solutionType, data);
                            }
                        });
                    
                    // Add text label for non-zero values
                    if (value > 0) {
                        g.append("text")
                            .attr("x", xScale(solutionType) + xScale.bandwidth() / 2)
                            .attr("y", yScale(role) + yScale.bandwidth() / 2)
                            .attr("text-anchor", "middle")
                            .attr("dominant-baseline", "middle")
                            .attr("class", "cell-value")
                            .style("fill", value > maxValue * 0.5 ? "white" : "#1f2937")
                            .style("pointer-events", "none")
                            .text(value);
                    }
                });
            });
            
            // Add x-axis labels
            g.selectAll(".x-axis-label")
                .data(data.solutionTypes)
                .enter()
                .append("text")
                .attr("class", "x-axis-label axis-label")
                .attr("x", d => xScale(d) + xScale.bandwidth() / 2)
                .attr("y", -10)
                .attr("transform", d => `rotate(-45, ${xScale(d) + xScale.bandwidth() / 2}, -10)`)
                .style("text-anchor", "end")
                .text(d => solutionTypeMap[d] || d);
            
            // Add y-axis labels with proper truncation for long labels
            g.selectAll(".y-axis-label")
                .data(data.roles)
                .enter()
                .append("text")
                .attr("class", "y-axis-label axis-label")
                .attr("x", -15)
                .attr("y", d => yScale(d) + yScale.bandwidth() / 2)
                .attr("dominant-baseline", "middle")
                .text(d => {
                    // Truncate very long labels
                    return d.length > 20 ? d.substring(0, 17) + '...' : d;
                })
                .append("title")
                .text(d => d); // Full text in tooltip
        }
        
        // Define solutionTypeMap globally
        const solutionTypeMap = {
            'Application': 'App',
            'Workflow': 'Gumloop',
            'NotebookLM': 'NotebookLM',
            'Other': 'Other',
            'Prompt': 'Prompt',
            'Shared Librechat Agent': 'LibreChat',
            'Gumloop Workflow': 'Gumloop',
            'Shared LibreChat Agent': 'LibreChat'
        };
        
        function showTooltip(event, role, solutionType, value) {
            const tooltip = d3.select(".tooltip");
            const percentage = ((value / currentData.totalEntries) * 100).toFixed(1);
            const displayName = solutionTypeMap[solutionType] || solutionType;
            
            tooltip.html(`
                <strong>${role}</strong><br/>
                <strong>${displayName}</strong><br/>
                Solutions: ${value}<br/>
                ${percentage}% of total
            `)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px")
            .style("opacity", 1);
        }
        
        function hideTooltip() {
            d3.select(".tooltip").style("opacity", 0);
        }
        
        function showDetails(role, solutionType, data) {
            const modal = document.getElementById("modal");
            const modalTitle = document.getElementById("modal-title");
            const modalBody = document.getElementById("modal-body");
            
            // Filter entries for this cell
            const relevantEntries = data.allEntries.filter(entry => 
                entry.roles.includes(role) && entry.solutionType === solutionType
            );
            
            const displayName = solutionTypeMap[solutionType] || solutionType;
            modalTitle.textContent = `${role} - ${displayName} (${relevantEntries.length} solutions)`;
            
            // Sort entries by date in reverse chronological order (most recent first)
            relevantEntries.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));
            
            // Build modal content
            let content = '';
            relevantEntries.forEach(entry => {
                const date = new Date(entry.updatedAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                content += `
                    <div class="solution-item">
                        <div class="solution-title">${entry.title || 'Untitled'}</div>
                        <div class="solution-meta">
                            <span>👤 ${entry.author}</span>
                            <span>🌍 ${entry.region || 'Unknown Region'}</span>
                            <span>📅 ${date}</span>
                        </div>
                        <div class="solution-description">
                            ${entry.description ? entry.description.substring(0, 300) + (entry.description.length > 300 ? '...' : '') : 'No description available'}
                        </div>
                        <div class="solution-links">
                            ${entry.slackUrl && entry.slackUrl !== 'none' ? 
                                `<a href="${entry.slackUrl}" target="_blank">View in Slack</a>` : ''}
                            ${entry.videoUrl && entry.videoUrl !== 'none' ? 
                                `<a href="${entry.videoUrl}" target="_blank">Watch Video</a>` : ''}
                            ${entry.appUrl && entry.appUrl !== 'none' ? 
                                `<a href="${entry.appUrl}" target="_blank">View App</a>` : ''}
                        </div>
                    </div>
                `;
            });
            
            modalBody.innerHTML = content;
            modal.style.display = "block";
            document.body.style.overflow = 'hidden';
            
            // Store current entries for word cloud
            modal.currentEntries = relevantEntries;
            
            // Setup view toggle event listeners
            setupViewToggle(relevantEntries);
        }
        
        // Modal close functionality
        document.querySelector(".close").onclick = function() {
            document.getElementById("modal").style.display = "none";
            document.body.style.overflow = 'auto';
        }
        
        window.onclick = function(event) {
            const modal = document.getElementById("modal");
            if (event.target == modal) {
                modal.style.display = "none";
                document.body.style.overflow = 'auto';
            }
        }
        
        // Setup view toggle for list/word cloud
        function setupViewToggle(entries) {
            const listBtn = document.getElementById('list-view-btn');
            const cloudBtn = document.getElementById('cloud-view-btn');
            const modalBody = document.getElementById('modal-body');
            const wordCloud = document.getElementById('word-cloud');
            
            listBtn.onclick = function() {
                listBtn.classList.add('active');
                cloudBtn.classList.remove('active');
                modalBody.style.display = 'block';
                wordCloud.style.display = 'none';
            };
            
            cloudBtn.onclick = function() {
                cloudBtn.classList.add('active');
                listBtn.classList.remove('active');
                modalBody.style.display = 'none';
                wordCloud.style.display = 'block';
                generateWordCloud(entries);
            };
            
            // Reset to list view when modal opens
            listBtn.click();
        }
        
        // Generate word cloud from titles
        function generateWordCloud(entries) {
            const stopWords = new Set([
                'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for',
                'of', 'with', 'by', 'from', 'up', 'about', 'into', 'through', 'during',
                'before', 'after', 'above', 'below', 'between', 'under', 'again',
                'further', 'then', 'once', 'is', 'am', 'are', 'was', 'were', 'be',
                'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could',
                'should', 'may', 'might', 'must', 'can', 'this', 'that', 'these',
                'those', 'i', 'you', 'he', 'she', 'it', 'we', 'they', 'them', 'their',
                'what', 'which', 'who', 'when', 'where', 'why', 'how', 'all', 'each',
                'every', 'some', 'few', 'more', 'most', 'other', 'such', 'only', 'own',
                'same', 'so', 'than', 'too', 'very', 'just', 'now'
            ]);
            
            // Extract and count words from titles
            const wordCounts = {};
            entries.forEach(entry => {
                if (entry.title) {
                    // Split by non-word characters and filter
                    const words = entry.title.toLowerCase()
                        .split(/[^a-z0-9]+/)
                        .filter(word => word.length > 2 && !stopWords.has(word));
                    
                    words.forEach(word => {
                        wordCounts[word] = (wordCounts[word] || 0) + 1;
                    });
                }
            });
            
            // Convert to array and sort by frequency
            const wordArray = Object.entries(wordCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 50); // Top 50 words
            
            // Clear and generate cloud
            const cloudContainer = document.getElementById('word-cloud');
            cloudContainer.innerHTML = '';
            
            if (wordArray.length === 0) {
                cloudContainer.innerHTML = '<p style="color: #6b7280; padding: 40px;">No word data available</p>';
                return;
            }
            
            // Calculate font sizes
            const maxCount = wordArray[0][1];
            const minCount = wordArray[wordArray.length - 1][1];
            const sizeScale = d3.scaleLinear()
                .domain([minCount, maxCount])
                .range([14, 48]);
            
            // Create word elements
            wordArray.forEach(([word, count]) => {
                const span = document.createElement('span');
                span.className = 'word-cloud-word';
                span.textContent = word;
                span.style.fontSize = `${sizeScale(count)}px`;
                span.style.color = d3.interpolateBlues(count / maxCount);
                span.title = `${word}: ${count} occurrence${count > 1 ? 's' : ''}`;
                
                // Add click handler to filter
                span.onclick = function() {
                    filterByWord(word, entries);
                };
                
                cloudContainer.appendChild(span);
            });
        }
        
        // Filter solutions by clicked word
        function filterByWord(word, allEntries) {
            const modalBody = document.getElementById('modal-body');
            const listBtn = document.getElementById('list-view-btn');
            
            // Filter entries that contain the word in title
            const filteredEntries = allEntries.filter(entry => 
                entry.title && entry.title.toLowerCase().includes(word.toLowerCase())
            );
            
            // Switch to list view and show filtered results
            listBtn.click();
            
            // Rebuild the list with filtered entries
            let content = `<div style="padding: 10px 20px; background-color: #f3f4f6; margin-bottom: 10px; border-radius: 4px;">
                            Filtered by word: <strong>${word}</strong> (${filteredEntries.length} results)
                            <button onclick="resetFilter()" style="margin-left: 10px; padding: 4px 8px; background: white; border: 1px solid #e5e7eb; border-radius: 4px; cursor: pointer;">Clear Filter</button>
                          </div>`;
            
            filteredEntries.forEach(entry => {
                const date = new Date(entry.updatedAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                content += `
                    <div class="solution-item">
                        <div class="solution-title">${highlightWord(entry.title || 'Untitled', word)}</div>
                        <div class="solution-meta">
                            <span>👤 ${entry.author}</span>
                            <span>🌍 ${entry.region || 'Unknown Region'}</span>
                            <span>📅 ${date}</span>
                        </div>
                        <div class="solution-description">
                            ${entry.description ? entry.description.substring(0, 300) + (entry.description.length > 300 ? '...' : '') : 'No description available'}
                        </div>
                        <div class="solution-links">
                            ${entry.slackUrl && entry.slackUrl !== 'none' ? 
                                `<a href="${entry.slackUrl}" target="_blank">View in Slack</a>` : ''}
                            ${entry.videoUrl && entry.videoUrl !== 'none' ? 
                                `<a href="${entry.videoUrl}" target="_blank">Watch Video</a>` : ''}
                            ${entry.appUrl && entry.appUrl !== 'none' ? 
                                `<a href="${entry.appUrl}" target="_blank">View App</a>` : ''}
                        </div>
                    </div>
                `;
            });
            
            modalBody.innerHTML = content;
        }
        
        // Highlight word in title
        function highlightWord(title, word) {
            const regex = new RegExp(`(${word})`, 'gi');
            return title.replace(regex, '<span style="background-color: #fbbf24; padding: 0 2px; border-radius: 2px;">$1</span>');
        }
        
        // Reset filter to show all entries
        function resetFilter() {
            const modal = document.getElementById("modal");
            const entries = modal.currentEntries;
            const modalBody = document.getElementById('modal-body');
            
            // Rebuild the original list
            let content = '';
            entries.forEach(entry => {
                const date = new Date(entry.updatedAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                content += `
                    <div class="solution-item">
                        <div class="solution-title">${entry.title || 'Untitled'}</div>
                        <div class="solution-meta">
                            <span>👤 ${entry.author}</span>
                            <span>🌍 ${entry.region || 'Unknown Region'}</span>
                            <span>📅 ${date}</span>
                        </div>
                        <div class="solution-description">
                            ${entry.description ? entry.description.substring(0, 300) + (entry.description.length > 300 ? '...' : '') : 'No description available'}
                        </div>
                        <div class="solution-links">
                            ${entry.slackUrl && entry.slackUrl !== 'none' ? 
                                `<a href="${entry.slackUrl}" target="_blank">View in Slack</a>` : ''}
                            ${entry.videoUrl && entry.videoUrl !== 'none' ? 
                                `<a href="${entry.videoUrl}" target="_blank">Watch Video</a>` : ''}
                            ${entry.appUrl && entry.appUrl !== 'none' ? 
                                `<a href="${entry.appUrl}" target="_blank">View App</a>` : ''}
                        </div>
                    </div>
                `;
            });
            
            modalBody.innerHTML = content;
        }
        
        // Responsive handling
        window.addEventListener('resize', () => {
            if (currentData) {
                createHeatmap(currentData);
            }
        });

        // Toggle experimental view
        function toggleExperimentalView() {
            isExperimentalView = !isExperimentalView;
            const toggle = document.getElementById('experimentalToggle');
            const defaultLegend = document.getElementById('defaultLegend');
            const jobsLegend = document.getElementById('jobsLegend');
            
            if (isExperimentalView) {
                toggle.classList.add('active');
                toggle.textContent = '🔬 Back to Standard View';
                defaultLegend.style.display = 'none';
                jobsLegend.style.display = 'block';
                
                // Update stats for jobs view
                updateStatsForJobs();
                
                // Create jobs heatmap
                if (jobsData) {
                    createJobsHeatmap(jobsData);
                }
            } else {
                toggle.classList.remove('active');
                toggle.textContent = '🧪 Experimental: Jobs View';
                defaultLegend.style.display = 'block';
                jobsLegend.style.display = 'none';
                
                // Back to standard view
                updateStats(currentData);
                createHeatmap(currentData);
            }
        }
        
        // Update stats for jobs view
        function updateStatsForJobs() {
            if (!jobsData) return;
            
            const statsContainer = document.getElementById('stats-container');
            const topJobs = Object.entries(jobsData.jobCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 4);
            
            statsContainer.innerHTML = `
                <div class="stat-card" onclick="showAllSolutions()" style="cursor: pointer;">
                    <p class="stat-number">${jobsData.totalEntries}</p>
                    <p class="stat-label">Total Solutions</p>
                </div>
                ${topJobs.map(([job, count]) => `
                    <div class="stat-card" onclick="showJobDetail('${job}')" style="cursor: pointer;">
                        <p class="stat-number">${count}</p>
                        <p class="stat-label" style="font-size: 0.8rem;">${job.split(' ').slice(0, 2).join(' ')}</p>
                    </div>
                `).join('')}
            `;
            
            // Populate job categories legend
            const jobCategories = document.getElementById('jobCategories');
            jobCategories.innerHTML = Object.keys(jobsData.jobCounts)
                .map(job => `<div class="job-item">${job}</div>`)
                .join('');
        }
        
        // Create jobs-based heatmap
        function createJobsHeatmap(data) {
            console.log('Creating jobs heatmap with data:', data);
            
            // Clear existing heatmap
            d3.select("#heatmap-container").selectAll("*").remove();
            
            const container = document.getElementById("heatmap-container");
            const width = container.clientWidth;
            const margin = { top: 150, right: 50, bottom: 120, left: 250 };
            const height = Math.max(400, data.jobs.length * 35) + margin.top + margin.bottom;
            
            // Create SVG
            const svg = d3.select("#heatmap-container")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
            
            // Calculate dimensions
            const xScale = d3.scaleBand()
                .domain(data.roles)
                .range([0, width - margin.left - margin.right])
                .padding(0.05);
            
            const yScale = d3.scaleBand()
                .domain(data.jobs)
                .range([0, data.jobs.length * 35])
                .padding(0.05);
                
            console.log('Jobs:', data.jobs);
            console.log('Roles:', data.roles);
            console.log('Matrix:', data.matrix);
            
            // Color scale - purple theme for experimental
            const maxValue = Math.max(...Object.values(data.matrix).flatMap(row => Object.values(row)));
            const colorScale = d3.scaleSequential()
                .domain([0, maxValue])
                .interpolator(d3.interpolatePurples);
            
            // Draw cells
            data.jobs.forEach(job => {
                data.roles.forEach(role => {
                    const value = data.matrix[job]?.[role] || 0;
                    if (value > 0) {
                        g.append("rect")
                            .attr("x", xScale(role))
                            .attr("y", yScale(job))
                            .attr("width", xScale.bandwidth())
                            .attr("height", yScale.bandwidth())
                            .attr("fill", colorScale(value))
                            .attr("stroke", "white")
                            .attr("stroke-width", 1)
                            .attr("rx", 4)
                            .attr("class", "heatmap-cell")
                            .on("click", function(event) {
                                showJobRoleDetails(job, role);
                            })
                            .on("mouseover", function(event) {
                                tooltip.style("visibility", "visible")
                                    .html(`<strong>${job}</strong><br>${role}<br>Solutions: ${value}`);
                                d3.select(this).attr("stroke-width", 3);
                            })
                            .on("mousemove", function(event) {
                                tooltip.style("top", (event.pageY - 10) + "px")
                                    .style("left", (event.pageX + 10) + "px");
                            })
                            .on("mouseout", function() {
                                tooltip.style("visibility", "hidden");
                                d3.select(this).attr("stroke-width", 1);
                            });
                    }
                });
            });
            
            // X axis - at the bottom
            g.append("g")
                .attr("transform", `translate(0, ${data.jobs.length * 35})`)
                .selectAll("text")
                .data(data.roles)
                .enter().append("text")
                .attr("x", d => xScale(d) + xScale.bandwidth() / 2)
                .attr("y", 10)
                .attr("text-anchor", "start")
                .attr("transform", d => `rotate(45, ${xScale(d) + xScale.bandwidth() / 2}, 10)`)
                .style("font-size", "11px")
                .style("fill", "white")
                .text(d => d);
            
            // Y axis
            g.append("g")
                .selectAll("text")
                .data(data.jobs)
                .enter().append("text")
                .attr("x", -10)
                .attr("y", d => yScale(d) + yScale.bandwidth() / 2)
                .attr("text-anchor", "end")
                .attr("alignment-baseline", "middle")
                .style("font-size", "12px")
                .style("fill", "white")
                .text(d => d);
        }
        
        // Show details for job-role combination
        function showJobRoleDetails(job, role) {
            const filteredData = csvData.filter(item => {
                const itemRoles = item.roles.split(';').map(r => r.trim());
                return itemRoles.includes(role);
            }).filter(item => {
                // Filter by job category
                const title = item.title.toLowerCase();
                const desc = item.description.toLowerCase();
                const combined = title + ' ' + desc;
                
                // Match job patterns (simplified for display)
                const jobPatterns = {
                    'Account Intelligence & Research': ['research', 'analyze', 'competitive', 'insight'],
                    'Content Generation & Localization': ['create', 'generate', 'translate', 'video'],
                    'Sales Process Optimization': ['sales', 'account plan', 'pipeline', 'deal'],
                    'Data Analysis & Reporting': ['data', 'report', 'metric', 'dashboard'],
                    'Workflow Automation': ['automate', 'scale', 'efficient', 'integrate'],
                    'Knowledge Centralization': ['centralize', 'organize', 'notebook', 'knowledge'],
                    'Partner & Collaboration': ['partner', 'agency', 'collaboration'],
                    'Learning & Training': ['learn', 'train', 'educate', 'enablement'],
                    'Communication & Outreach': ['communicate', 'outreach', 'email', 'messaging'],
                    'Product & Demo Creation': ['demo', 'mockup', 'prototype', 'build']
                };
                
                const keywords = jobPatterns[job] || [];
                return keywords.some(keyword => combined.includes(keyword));
            });
            
            showModal(`${job} - ${role}`, filteredData);
        }
        
        // Show job detail view
        function showJobDetail(job) {
            currentView = 'job';
            currentListFilters.clear();
            const filteredData = csvData.filter(item => {
                const title = item.title.toLowerCase();
                const desc = item.description.toLowerCase();
                const combined = title + ' ' + desc;
                
                // Match job patterns
                const jobPatterns = {
                    'Account Intelligence & Research': ['research', 'analyze', 'competitive', 'insight'],
                    'Content Generation & Localization': ['create', 'generate', 'translate', 'video'],
                    'Sales Process Optimization': ['sales', 'account plan', 'pipeline', 'deal'],
                    'Data Analysis & Reporting': ['data', 'report', 'metric', 'dashboard'],
                    'Workflow Automation': ['automate', 'scale', 'efficient', 'integrate'],
                    'Knowledge Centralization': ['centralize', 'organize', 'notebook', 'knowledge'],
                    'Partner & Collaboration': ['partner', 'agency', 'collaboration'],
                    'Learning & Training': ['learn', 'train', 'educate', 'enablement'],
                    'Communication & Outreach': ['communicate', 'outreach', 'email', 'messaging'],
                    'Product & Demo Creation': ['demo', 'mockup', 'prototype', 'build']
                };
                
                const keywords = jobPatterns[job] || [];
                return keywords.some(keyword => combined.includes(keyword));
            });
            
            showModal(`Job: ${job}`, filteredData);
        }
        
        // List view functions
        function showAllSolutions() {
            currentView = 'all';
            currentListFilters.clear();
            document.getElementById('allSolutionsView').style.display = 'block';
            renderAllSolutions();
        }
        
        function showRolesList() {
            document.getElementById('rolesListView').style.display = 'block';
            renderRolesInterstitial();
        }
        
        function showSolutionTypesList() {
            document.getElementById('solutionTypesListView').style.display = 'block';
            renderSolutionTypesInterstitial();
        }
        
        function closeListView(viewId) {
            document.getElementById(viewId).style.display = 'none';
            if (viewId === 'roleDetailView') {
                showRolesList();
            } else if (viewId === 'typeDetailView') {
                showSolutionTypesList();
            }
        }
        
        function renderAllSolutions() {
            const filteredData = currentListFilters.size > 0 
                ? csvData.filter(item => {
                    const itemTags = item.tags.split(',').map(t => t.trim().toLowerCase());
                    return Array.from(currentListFilters).some(filter => 
                        itemTags.includes(filter.toLowerCase())
                    );
                })
                : csvData;
            
            // Build word cloud
            const tagCounts = {};
            filteredData.forEach(item => {
                item.tags.split(',').forEach(tag => {
                    const cleanTag = tag.trim();
                    if (cleanTag) {
                        tagCounts[cleanTag] = (tagCounts[cleanTag] || 0) + 1;
                    }
                });
            });
            
            const cloudHtml = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20)
                .map(([tag, count]) => {
                    const isActive = currentListFilters.has(tag);
                    return `<span class="tag ${isActive ? 'active' : ''}" 
                            onclick="toggleListFilter('${tag}')">${tag} (${count})</span>`;
                }).join('');
            
            document.getElementById('allSolutionsCloud').innerHTML = cloudHtml;
            document.getElementById('allSolutionsFilterInfo').textContent = 
                currentListFilters.size > 0 
                    ? `Showing ${filteredData.length} solutions filtered by: ${Array.from(currentListFilters).join(', ')}`
                    : `Showing all ${filteredData.length} solutions`;
            
            const listHtml = filteredData.map(item => renderSolutionItem(item)).join('');
            document.getElementById('allSolutionsList').innerHTML = listHtml;
        }
        
        function renderRolesInterstitial() {
            const roleCounts = {};
            csvData.forEach(item => {
                const roles = item.roles.split(',').map(r => r.trim());
                roles.forEach(role => {
                    if (role) {
                        roleCounts[role] = (roleCounts[role] || 0) + 1;
                    }
                });
            });
            
            const html = Object.entries(roleCounts)
                .sort((a, b) => b[1] - a[1])
                .map(([role, count]) => `
                    <div class="interstitial-item" onclick="showRoleDetail('${role}')">
                        <h3>${role}</h3>
                        <div class="count">${count}</div>
                        <span style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">solutions</span>
                    </div>
                `).join('');
            
            document.getElementById('rolesGrid').innerHTML = html;
        }
        
        function renderSolutionTypesInterstitial() {
            const typeCounts = {};
            csvData.forEach(item => {
                if (item.solutionType) {
                    typeCounts[item.solutionType] = (typeCounts[item.solutionType] || 0) + 1;
                }
            });
            
            const html = Object.entries(typeCounts)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => `
                    <div class="interstitial-item" onclick="showTypeDetail('${type}')">
                        <h3>${type}</h3>
                        <div class="count">${count}</div>
                        <span style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem;">solutions</span>
                    </div>
                `).join('');
            
            document.getElementById('solutionTypesGrid').innerHTML = html;
        }
        
        function showRoleDetail(role) {
            currentView = 'role';
            currentListFilters.clear();
            document.getElementById('rolesListView').style.display = 'none';
            document.getElementById('roleDetailView').style.display = 'block';
            document.getElementById('roleDetailTitle').textContent = `${role} Solutions`;
            renderRoleDetail(role);
        }
        
        function showTypeDetail(type) {
            currentView = 'type';
            currentListFilters.clear();
            document.getElementById('solutionTypesListView').style.display = 'none';
            document.getElementById('typeDetailView').style.display = 'block';
            document.getElementById('typeDetailTitle').textContent = `${type} Solutions`;
            renderTypeDetail(type);
        }
        
        function renderRoleDetail(role) {
            let filteredData = csvData.filter(item => 
                item.roles.split(',').map(r => r.trim()).includes(role)
            );
            
            if (currentListFilters.size > 0) {
                filteredData = filteredData.filter(item => {
                    const itemTags = item.tags.split(',').map(t => t.trim().toLowerCase());
                    return Array.from(currentListFilters).some(filter => 
                        itemTags.includes(filter.toLowerCase())
                    );
                });
            }
            
            // Build word cloud for this role
            const tagCounts = {};
            filteredData.forEach(item => {
                item.tags.split(',').forEach(tag => {
                    const cleanTag = tag.trim();
                    if (cleanTag) {
                        tagCounts[cleanTag] = (tagCounts[cleanTag] || 0) + 1;
                    }
                });
            });
            
            const cloudHtml = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20)
                .map(([tag, count]) => {
                    const isActive = currentListFilters.has(tag);
                    return `<span class="tag ${isActive ? 'active' : ''}" 
                            onclick="toggleListFilter('${tag}', 'role', '${role}')">${tag} (${count})</span>`;
                }).join('');
            
            document.getElementById('roleDetailCloud').innerHTML = cloudHtml;
            document.getElementById('roleDetailFilterInfo').textContent = 
                currentListFilters.size > 0 
                    ? `Showing ${filteredData.length} ${role} solutions filtered by: ${Array.from(currentListFilters).join(', ')}`
                    : `Showing all ${filteredData.length} ${role} solutions`;
            
            const listHtml = filteredData.map(item => renderSolutionItem(item)).join('');
            document.getElementById('roleDetailList').innerHTML = listHtml;
        }
        
        function renderTypeDetail(type) {
            let filteredData = csvData.filter(item => item.solutionType === type);
            
            if (currentListFilters.size > 0) {
                filteredData = filteredData.filter(item => {
                    const itemTags = item.tags.split(',').map(t => t.trim().toLowerCase());
                    return Array.from(currentListFilters).some(filter => 
                        itemTags.includes(filter.toLowerCase())
                    );
                });
            }
            
            // Build word cloud for this type
            const tagCounts = {};
            filteredData.forEach(item => {
                item.tags.split(',').forEach(tag => {
                    const cleanTag = tag.trim();
                    if (cleanTag) {
                        tagCounts[cleanTag] = (tagCounts[cleanTag] || 0) + 1;
                    }
                });
            });
            
            const cloudHtml = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20)
                .map(([tag, count]) => {
                    const isActive = currentListFilters.has(tag);
                    return `<span class="tag ${isActive ? 'active' : ''}" 
                            onclick="toggleListFilter('${tag}', 'type', '${type}')">${tag} (${count})</span>`;
                }).join('');
            
            document.getElementById('typeDetailCloud').innerHTML = cloudHtml;
            document.getElementById('typeDetailFilterInfo').textContent = 
                currentListFilters.size > 0 
                    ? `Showing ${filteredData.length} ${type} solutions filtered by: ${Array.from(currentListFilters).join(', ')}`
                    : `Showing all ${filteredData.length} ${type} solutions`;
            
            const listHtml = filteredData.map(item => renderSolutionItem(item)).join('');
            document.getElementById('typeDetailList').innerHTML = listHtml;
        }
        
        function renderSolutionItem(item) {
            const date = new Date(item.updatedAt).toLocaleDateString();
            const links = [];
            if (item.appUrl) links.push(`<a href="${item.appUrl}" target="_blank">View App</a>`);
            if (item.videoUrl) links.push(`<a href="${item.videoUrl}" target="_blank">Watch Video</a>`);
            if (item.slackUrl) links.push(`<a href="${item.slackUrl}" target="_blank">Slack</a>`);
            
            return `
                <div class="solution-item">
                    <h3>${item.title}</h3>
                    <div class="description">${item.description}</div>
                    <div class="meta">
                        <span>👤 ${item.author}</span>
                        <span>📅 ${date}</span>
                        <span>🌍 ${item.creatorRegion}</span>
                        <span>🏷️ ${item.solutionType}</span>
                    </div>
                    ${links.length > 0 ? `<div class="solution-links">${links.join('')}</div>` : ''}
                </div>
            `;
        }
        
        function toggleListFilter(tag, viewType, viewParam) {
            if (currentListFilters.has(tag)) {
                currentListFilters.delete(tag);
            } else {
                currentListFilters.add(tag);
            }
            
            // Re-render the appropriate view
            if (viewType === 'role') {
                renderRoleDetail(viewParam);
            } else if (viewType === 'type') {
                renderTypeDetail(viewParam);
            } else {
                renderAllSolutions();
            }
        }
    </script>
</body>
</html> 